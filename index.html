<!DOCTYPE html>
<html lang="zh-TW">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cayo Perico 搶劫計算機</title>
  <link rel="stylesheet" href="css/style.css?nocache=1014" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  
  <script>
    const nocache = 1014;
  </script>
</head>

<body>
  <div class="app-container fade-in">
    
    <div class="input-section">
      <header>
        <h1><i class="fas fa-terminal"></i> Cayo Perico 計算機</h1>
        <p class="subtitle">佩里克島搶劫戰利品計算 | v2.0 AI Optimized</p>
      </header>

      <section class="panel settings-panel slide-in">
        <h2><i class="fas fa-cog"></i> 任務設定</h2>
        <div class="settings-grid">
          <div class="setting-item">
            <label>難度模式</label>
            <select id="isHardMode">
              <option value="false">普通</option>
              <option value="true">困難</option>
            </select>
          </div>
          <div class="setting-item">
            <label>玩家人數</label>
            <select id="amountOfPlayers">
              <option value="1">1 人 (單刷)</option>
              <option value="2" selected>2 人</option>
              <option value="3">3 人</option>
              <option value="4">4 人</option>
            </select>
          </div>
          <div class="setting-item">
            <label>精英挑戰</label>
            <select id="isWithinCooldown">
              <option value="false">無 (> 72h)</option>
              <option value="true">有 (< 72h)</option>
            </select>
          </div>
          <div class="setting-item">
            <label for="goldAlone">單人拿黃金?</label>
            <select id="goldAlone">
              <option value="false">否</option>
              <option value="true">是</option>
            </select>
          </div>
        </div>
      </section>

      <section class="panel primary-panel slide-in" style="animation-delay: 0.1s;">
        <h2><i class="fas fa-gem"></i> 主要目標</h2>
        <select id="primaryTarget" style="display:none">
          <option value="tequila">Tequila</option>
          <option value="ruby_necklace">Ruby Necklace</option>
          <option value="bearer_bonds">Bearer Bonds</option>
          <option value="pink_diamond" selected>Pink Diamond</option>
          <option value="panther_statue">Panther Statue</option>
        </select>

        <div class="primary-grid">
          <div class="primary-card" onclick="selectPrimary('tequila', this)">
            <div class="p-card-image">
              <img src="assets/tequila.png" alt="龍舌蘭" onerror="this.style.display='none'">
              <i class="fas fa-wine-bottle fallback-icon"></i>
            </div>
            <span class="p-card-title">龍舌蘭</span>
          </div>

          <div class="primary-card" onclick="selectPrimary('ruby_necklace', this)">
            <div class="p-card-image">
              <img src="assets/necklace.png" alt="紅寶石項鍊" onerror="this.style.display='none'">
              <i class="fas fa-ring fallback-icon"></i>
            </div>
            <span class="p-card-title">紅寶石項鍊</span>
          </div>

          <div class="primary-card" onclick="selectPrimary('bearer_bonds', this)">
            <div class="p-card-image">
              <img src="assets/bonds.png" alt="無記名債券" onerror="this.style.display='none'">
              <i class="fas fa-file-invoice-dollar fallback-icon"></i>
            </div>
            <span class="p-card-title">無記名債券</span>
          </div>

          <div class="primary-card active" onclick="selectPrimary('pink_diamond', this)" id="default-primary">
            <div class="p-card-image">
              <img src="assets/diamond.png" alt="粉鑽" onerror="this.style.display='none'">
              <i class="far fa-gem fallback-icon"></i>
            </div>
            <span class="p-card-title">粉鑽</span>
          </div>

          <div class="primary-card" onclick="selectPrimary('panther_statue', this)">
            <div class="p-card-image">
              <img src="assets/panther.png" alt="美洲豹雕像" onerror="this.style.display='none'">
              <i class="fas fa-cat fallback-icon"></i>
            </div>
            <span class="p-card-title">美洲豹雕像</span>
          </div>
        </div>
      </section>

      <section class="panel loot-panel slide-in" style="animation-delay: 0.2s;">
        <div class="panel-header">
           <h2><i class="fas fa-eye"></i> 偵察到的次要目標 (數量)</h2>
           <button id="optimize-btn" class="btn-optimize"><i class="fas fa-magic"></i> 一鍵計算最佳拿法</button>
        </div>
        
        <div class="loot-grid">
          <div class="loot-card gold">
            <div class="card-image">
              <img src="assets/gold_bar.png" alt="黃金" onerror="this.style.display='none'">
              <span class="card-title">黃金</span>
            </div>
            <div class="counter-control">
              <button class="btn-minus" onclick="updateInput('gold', -1)">-</button>
              <input type="number" id="gold" value="0" min="0" max="8" readonly>
              <button class="btn-plus" onclick="updateInput('gold', 1)">+</button>
            </div>
          </div>

          <div class="loot-card cocaine">
            <div class="card-image">
              <img src="assets/cocaine.png" alt="古柯鹼" onerror="this.style.display='none'">
              <span class="card-title">古柯鹼</span>
            </div>
            <div class="counter-control">
              <button class="btn-minus" onclick="updateInput('cocaine', -1)">-</button>
              <input type="number" id="cocaine" value="0" min="0" max="15" readonly>
              <button class="btn-plus" onclick="updateInput('cocaine', 1)">+</button>
            </div>
          </div>

          <div class="loot-card weed">
            <div class="card-image">
              <img src="assets/weed.png" alt="大麻" onerror="this.style.display='none'">
              <span class="card-title">大麻</span>
            </div>
            <div class="counter-control">
              <button class="btn-minus" onclick="updateInput('weed', -1)">-</button>
              <input type="number" id="weed" value="0" min="0" max="15" readonly>
              <button class="btn-plus" onclick="updateInput('weed', 1)">+</button>
            </div>
          </div>

          <div class="loot-card paintings">
            <div class="card-image">
              <img src="assets/painting.png" alt="畫作" onerror="this.style.display='none'">
              <span class="card-title">畫作</span>
            </div>
            <div class="counter-control">
              <button class="btn-minus" onclick="updateInput('paintings', -1)">-</button>
              <input type="number" id="paintings" value="0" min="0" max="10" readonly>
              <button class="btn-plus" onclick="updateInput('paintings', 1)">+</button>
            </div>
          </div>

          <div class="loot-card cash">
            <div class="card-image">
              <img src="assets/cash.png" alt="現金" onerror="this.style.display='none'">
              <span class="card-title">現金</span>
            </div>
            <div class="counter-control">
              <button class="btn-minus" onclick="updateInput('cash', -1)">-</button>
              <input type="number" id="cash" value="0" min="0" max="15" readonly>
              <button class="btn-plus" onclick="updateInput('cash', 1)">+</button>
            </div>
          </div>
        </div>
        <p class="hint-text">* 請輸入你在島上偵察到的總數量，然後點擊上方「一鍵計算」</p>
      </section>
    </div>

    <div class="result-section fade-in" style="animation-delay: 0.3s;">
      <div class="sticky-wrapper">
        <div class="result-card main-profit">
          <h3>預估最高收益</h3>
          <div id="max-loot-value" class="highlight-value">0</div>
          
          <div id="taken-loot-display" class="taken-loot-list hidden">
            </div>

          <div class="bag-status">
            <span>背包容量: <span id="bags_fill">0</span> / <span id="max_bags_display">2</span></span>
            <div class="progress-bar-bg"><div class="progress-bar-fill" id="bag-bar" style="width: 0%"></div></div>
          </div>
        </div>

        <div class="result-card details">
          <h4><i class="fas fa-calculator"></i> 收支明細</h4>
          <div class="detail-row"><span>辦公室保險箱:</span> <span id="office-safe">0</span></div>
          <div class="detail-row"><span>精英挑戰:</span> <span id="elite-challenge">0</span></div>
          <div class="detail-row minus"><span>洗錢費用 (10%):</span> <span id="fencing-fee">0</span></div>
          <div class="detail-row minus"><span>帕維爾 (2%):</span> <span id="pavel-fee">0</span></div>
        </div>

        <div class="result-card player-cuts">
          <h4><i class="fas fa-users"></i> 玩家分紅 <span id="cut-warning" class="warning-text hidden">(總和超過 100%!)</span></h4>
          <div class="cuts" id="cuts-container">
            <div class="cut-row">
              <label>隊長</label>
              <input type="number" id="leaderCut" value="85" step="5" min="0" max="100">
              <span></span>
            </div>
            <div class="cut-row">
              <label>隊員 1</label>
              <input type="number" id="member1Cut" value="15" step="5" min="0" max="100">
              <span></span>
            </div>
             <div class="cut-row hidden" id="cut-p3-wrapper">
              <label>隊員 2</label>
              <input type="number" id="member2Cut" value="15" step="5" min="0" max="100">
              <span></span>
            </div>
             <div class="cut-row hidden" id="cut-p4-wrapper">
              <label>隊員 3</label>
              <input type="number" id="member3Cut" value="15" step="5" min="0" max="100">
              <span></span>
            </div>
          </div>
        </div>

        <div class="hidden-logic-elements" style="display:none;">
           <div id="gold-stacks-value"></div><div id="gold-bags-value"></div><div id="gold-bag-percent"></div>
           <div id="cocaine-stacks-value"></div><div id="cocaine-bags-value"></div><div id="cocaine-bag-percent"></div>
           <div id="weed-stacks-value"></div><div id="weed-bags-value"></div><div id="weed-bag-percent"></div>
           <div id="paintings-stacks-value"></div><div id="paintings-bags-value"></div><div id="paintings-bag-percent"></div>
           <div id="cash-stacks-value"></div><div id="cash-bags-value"></div><div id="cash-bag-percent"></div>
           <div class="big" id="gold-bag"></div>
           <div class="big" id="cocaine-bag"></div>
           <div class="big" id="weed-bag"></div>
           <div class="big" id="paintings-bag"></div>
           <div class="big" id="cash-bag"></div>
        </div>
        
        <div class="action-buttons">
          <button id="reset-settings" class="btn-secondary">重置</button>
          <button id="link-settings" class="btn-secondary">複製連結</button>
        </div>
      </div>
    </div>
  </div>

  <script src="js/loader.js?nocache=1014"></script>
  <script src="js/settings.js?nocache=1014"></script>
  <script src="js/logic.js?nocache=1014"></script>
  
  <script>
    // 輔助與 UI 初始化
    function updateInput(id, change) {
      const input = document.getElementById(id);
      let newVal = parseInt(input.value) + change;
      if (newVal >= input.min && newVal <= input.max) {
        input.value = newVal;
        // 觸發自定義事件，讓 logic.js 捕捉
        input.dispatchEvent(new Event('change'));
      }
    }

    function selectPrimary(value, element) {
      const select = document.getElementById('primaryTarget');
      select.value = value;
      select.dispatchEvent(new Event('change'));
      document.querySelectorAll('.primary-card').forEach(card => card.classList.remove('active'));
      element.classList.add('active');
    }

    window.addEventListener('DOMContentLoaded', () => {
        setTimeout(() => {
          const currentVal = document.getElementById('primaryTarget').value;
          document.querySelectorAll('.primary-card').forEach(card => {
            if(card.getAttribute('onclick').includes(currentVal)) {
               card.classList.add('active');
            } else {
               card.classList.remove('active');
            }
          });
        }, 200);
    });

    // 綁定優化按鈕
    document.getElementById('optimize-btn').addEventListener('click', () => {
        if(typeof Counter !== 'undefined' && Counter.optimize) {
            Counter.optimize();
        } else {
            alert("正在載入邏輯，請稍後...");
        }
    });
  </script>
</body>
</html>